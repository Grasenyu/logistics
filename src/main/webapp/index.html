<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>Insert title here</title>
		<!--导入bootstarp-->
		<link rel="stylesheet" type="text/css" href="js/bootstarp-3.3.7/css/bootstrap.min.css" />
		<script src="js/jquery-3.2.0.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/bootstarp-3.3.7/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
		<!--导入bootstarp-table-->
		<link rel="stylesheet" type="text/css" href="js/bootstarp-table-1.11.1/bootstrap-table.min.css" />
		<script src="js/bootstarp-table-1.11.1/bootstrap-table.min.js" type="text/javascript" charset="utf-8"></script>
		<!--导入bootstarp-table中文-->
		<script src="js/bootstarp-table-1.11.1/bootstrap-table-zh-CN.min.js" type="text/javascript" charset="utf-8"></script>
		<!--jquery代码片段-->
		<script type="text/javascript">
			//入口函数
			$(function() {
					$("#table").bootstrapTable({
							url:"MyServlet?type=allstu",//请求后台的url
							contentType:"json",
							pagination:true,
							search:false,
							sortable: false,     
							showRefresh:false,
	//						queryParams:queryParams,
							queryParams:queryParams,
							pageNumber:"1",　　//启用插件时默认页数
						      pageSize:"15",　　//启用插件是默认每页的数据条数
						      pageList:[10, 25, 50, 100],　　//自定义每页的数量
							pageSize:3,
							dataType:"json",
							columns:[{
								field:"sid",
								title:"编号",
								align:"center",
							},{
								field:"sname",
								title:"姓名",
								align:"center",
							},{
								field:"score",
								title:"分数", 
								align:"center",
							},{
								field:"sex",
								title:"性别",
								align:"center",
							},{
								field:"cname",
								title:"班级",
								align:"center",
							},{
								field:"kname",
								title:"科目",
								align:"center",
							},{
								field:"sid",
								title:"操作",
								align:"center",
								formatter:function(value,row,index){
									return '<button class="btn btn-info" data-toggle="modal" data-target="#myModal" onclick="update('+row.sid+')" >修改</button> <button class="btn btn-info" onclick="del('+row.sid+')">删除</button>'
								}
							}
							
							]
						})
					$.getJSON("MyServlet?type=cname",function(cname){
						  for(i=0;i<cname.length;i++){
						  	$("#cid,#cla").append("<option value='"+cname[i].cid+"'>"+cname[i].cname+"</option>");
						  }
					})
					$.getJSON("MyServlet?type=kname",function(kname){
						  for(i=0;i<kname.length;i++){
						  	$("#kid,#kmu").append("<option value='"+kname[i].kid+"'>"+kname[i].kname+"</option>");
						  }
					})
					
			})
			
			function update(sid){ 
				$("#btn").html("修改");
				$.ajax({
					type:"post",
					url:"MyServlet?type=update",
					data:"sid="+sid,
					success:function(data){
						var datas = JSON.parse(data);
						$("#sid").val(datas.sid);
						$("#sname").val(datas.sname);
						$("#score").val(datas.score);
						if ($("#sex").val=="男") {
							$("#sex").prop("checked",true);
						} else{
							$("#sex").prop("checked",true);
						}
						$("#cid").val(datas.cid);
						$("#kid").val(datas.kid);
					}
				});
			}
			function del(sid){
				alert(sid);
				$.ajax({
					type:"post",
					url:"MyServlet?type=del",
					data:"sid="+sid,
					success:function(){
						$("#table").bootstrapTable("refresh");
					}
				});
			}
			function addok(){

				var str ="";
				if ($("#btn").html()=='添加') { 
					str="addok";
					alert(str)
				} else if($("#btn").html()=='修改'){
					str="updateok";
					alert(str)
				}
				
				var data = $("#addform").serialize();
				var params = decodeURIComponent(data,true); 
				alert(params)
				alert(params);
				$.ajax({
					type:"post",
					url:"MyServlet?type="+str,
					data:params,
					success:function(data){
						$("#myModal").modal("hide");
						$("#table").bootstrapTable("refresh")
					}
				});
			}
			
			
			function myModal(){
				
				$("#sname").val("");
				$("#score").val("");
						
				$("#sex").prop("checked",true);
						
				$("#cid").val();
				$("#kid").val();
				$("#myModal").modal("show");
				$("#btn").html("添加");
			}
			function select(){
				$("#table").bootstrapTable("refresh");
			}
			function queryParams(params){ 
				return data={
 					sname:$("#name1").val(),
				    cid:$("#cla").val(),
				    kid:$("#kmu").val(),
				}
			}
			
		</script>

	</head>

	<body >
		<h3>学生信息</h3>
	<div>
		<p align="center">

    <label for="sname" class="col-sm-1 control-label">学生姓名</label>
    <div class="col-sm-4">
      <input type="text" class="form-control" name="name1" id="name1" placeholder="学生姓名">
    </div>
    <label class="radio-inline">
	<select name="" id="cla">
		<option value="0">--请选择--</option>
	</select>
	</label>
	 <label class="radio-inline">
	<select name="" id="kmu">
		<option value="0">--请选择--</option>
	</select>
	</label>
	<button type="button" class="btn btn-primary "  onclick="select()" >
		查询
	</button>
		<!-- Button trigger modal -->
	<button type="button" class="btn btn-primary "  onclick="myModal()" id="add">
		添加
	</button>
	</p>
    
	</div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">学生信息</h4>
      </div>
      <div class="modal-body">
       
       	<form class="form-horizontal" id="addform">
       	<input type="hidden" name="sid" id="sid" value="" />
  <div class="form-group">
    <label for="sname" class="col-sm-2 control-label">学生姓名</label>
    <div class="col-sm-10">
      <input type="email" class="form-control" name="sname" id="sname" placeholder="学生姓名">
    </div>
  </div>
  <div class="form-group">
    <label for="score" class="col-sm-2 control-label">分&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="score" id="score" placeholder="请输入学生分数">
    </div>
  </div>
  <div class="form-group">
  	<label  class="col-sm-2 control-label">学生姓名</label>
    <div class="col-sm-10">
      <!--<div class="checkbox">-->
              	<label class="radio-inline">
			  <input type="radio" name="sex" id="sex" value="男">男
			</label>
			<label class="radio-inline">
			  <input type="radio" name="sex" id="sex" value="女">女
			</label>
      <!--</div>-->
    </div>
  </div>
  <div class="form-group">
    <label  class="col-sm-2 control-label">班&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;级</label>
    <div class="col-sm-10">
    <label class="radio-inline">
			  <select name="cid" id="cid">
			  
			  </select>
	</label>

    </div>
  </div>
  
  <div class="form-group">
    <label  class="col-sm-2 control-label">科&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目</label>
    <div class="col-sm-10">
    <label class="radio-inline">
			  <select name="kid" id="kid">
			  
			  </select>
	</label>

    </div>
  </div>
</form>
       
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary" onclick="addok()" id="btn">添加信息</button>
      </div>
    </div>
  </div>
</div>
		<table id="table" >
	
		</table>
	</body>

</html>